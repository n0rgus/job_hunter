{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<form method="post" action="/role/add">
  <input type="text" name="role_name" placeholder="New Role Name" required>
  <button type="submit">Add Role</button>
</form>

<table class="roles">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>Toggle</th>
      <th>Add Keyword</th>
    </tr>
  </thead>
  <tbody>
  {% for role in roles %}
    <tr class="role-row {% if role['enabled'] %}enabled{% else %}disabled{% endif %}">
      <td><button type="button" class="toggle-keywords" data-role="{{ role['role_id'] }}">+</button></td>
      <td>{{ role['role_name'] }}</td>
      <td>
        <form method="post" action="/role/toggle/{{ role['role_id'] }}">
          <button type="submit">{{ 'Disable' if role['enabled'] else 'Enable' }}</button>
        </form>
      </td>
      <td>
        <form method="post" action="/keyword/add/{{ role['role_id'] }}" class="add-keyword">
          <input type="text" name="keyword" placeholder="New keyword" required>
          <button type="submit">Add</button>
        </form>
      </td>
    </tr>
    {% for kw in role['keywords'] %}
    <tr class="keyword-row role-{{ role['role_id'] }} {% if kw['enabled'] %}enabled{% else %}disabled{% endif %} hidden">
      <td></td>
      <td>{{ kw['keyword'] }}</td>
      <td>
        <form method="post" action="/keyword/toggle/{{ kw['keyword_id'] }}">
          <button type="submit">{{ 'Disable' if kw['enabled'] else 'Enable' }}</button>
        </form>
      </td>
      <td></td>
    </tr>
    {% endfor %}
  {% endfor %}
  </tbody>
</table>

<style>
  table.roles { width: 100%; border-collapse: collapse; }
  table.roles th, table.roles td { border: 1px solid #ddd; padding: 8px; }
  .enabled { background-color: #e0ffe0; }
  .disabled { background-color: #ffe0e0; }
  .hidden { display: none; }
  .add-keyword { display: flex; gap: 5px; }
  .add-keyword input { flex: 1; }
</style>

<script>
document.querySelectorAll('.toggle-keywords').forEach(btn => {
  btn.addEventListener('click', () => {
    const roleId = btn.getAttribute('data-role');
    document.querySelectorAll('.keyword-row.role-' + roleId).forEach(row => {
      row.classList.toggle('hidden');
    });
    btn.textContent = btn.textContent === '+' ? '-' : '+';
  });
});
</script>
{% endblock %}